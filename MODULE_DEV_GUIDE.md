# The Ultimate Encyclopedia of Userbot Development (FTG / Hikka)
# –ë–∏–±–ª–∏—è –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞: Grandmaster Edition

> **–í–µ—Ä—Å–∏—è**: 3.0 Final
> **–û–±—ä–µ–º**: 1200+ —Å—Ç—Ä–æ–∫
> **–û—Ö–≤–∞—Ç**: Friendly-Telegram (FTG), Hikka, Heroku, Inline Bots, Grafana, Telethon Internals

---

## üèóÔ∏è –û–ì–õ–ê–í–õ–ï–ù–ò–ï –≠–ù–¶–ò–ö–õ–û–ü–ï–î–ò–ò

### –ß–∞—Å—Ç—å I: –§—É–Ω–¥–∞–º–µ–Ω—Ç (The Foundation)
1.  **–í–≤–µ–¥–µ–Ω–∏–µ –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º—É**
    *   MTProto vs Bot API
    *   –†–∞–∑–ª–∏—á–∏—è FTG –∏ Hikka
    *   –≠—Ç–∏–∫–∞ Userbot-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
2.  **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —è–¥—Ä–∞ Loader**
    *   –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `import` –≤ Runtime
    *   Dependency Injection (`client`, `db`, `allmodules`)
    *   Security Policy Enforcement
3.  **–û—Å–Ω–æ–≤—ã —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥—É–ª—è**
    *   Hello World (–ü–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∞—Ç–æ–º–æ–≤)
    *   –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (`strings`, `docstrings`, `assets`)
    *   –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª (`__init__`, `client_ready`, `on_unload`)

### –ß–∞—Å—Ç—å II: –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ (Data Engineering)
4.  **–ö–æ–º–∞–Ω–¥–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (CLI)**
    *   –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (`get_args` vs `argparse`)
    *   –§–ª–∞–≥–∏ –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    *   –ê–ª–∏–∞—Å—ã –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
5.  **–°–∏—Å—Ç–µ–º–∞ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (Config)**
    *   –¢–∏–ø—ã –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤ (`Choice`, `hidden`, `Series`)
    *   –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞
6.  **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Database)**
    *   KV-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Key-Value)
    *   –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    *   –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–æ–¥—É–ª—è

### –ß–∞—Å—Ç—å III: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Telegram (Telethon Deep Dive)
7.  **–°–æ–æ–±—â–µ–Ω–∏—è –∏ –°–æ–±—ã—Ç–∏—è**
    *   –ê–Ω–∞—Ç–æ–º–∏—è –æ–±—ä–µ–∫—Ç–∞ `Message`
    *   –†–∞–∑–Ω–∏—Ü–∞ `reply`, `respond`, `edit`, `answer`
    *   –†–∞–±–æ—Ç–∞ —Å –º–µ–¥–∏–∞ (Upload/Download streams)
8.  **–°—É—â–Ω–æ—Å—Ç–∏ –∏ –ü–∏—Ä—ã (Entities & Peers)**
    *   `InputPeer` vs `Peer` vs `User`
    *   –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ `get_input_entity`
    *   Resolve username –º–µ—Ö–∞–Ω–∏–∑–º—ã
9.  **Inline-–ë–æ—Ç—ã –∏ –ö–Ω–æ–ø–∫–∏ (Hybrid Mode)**
    *   –ó–∞–ø—É—Å–∫ `@bot` –≤–Ω—É—Ç—Ä–∏ —é–∑–µ—Ä–±–æ—Ç–∞
    *   InlineQuery –∏ `SwitchInlineQuery`
    *   CallbackQueryHandler (–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π)
    *   –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏

### –ß–∞—Å—Ç—å IV: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ DevOps
10. **Hikka Specific Features**
    *   `self.hikka` –∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ API
    *   –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `hikkatl`
    *   –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º Hikka
11. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ Observability (Grafana/Prometheus)**
    *   –ó–∞–ø—É—Å–∫ HTTP-—Å–µ—Ä–≤–µ—Ä–∞ (`aiohttp`) –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª—è
    *   –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ (RPS, Errors, Latency)
    *   –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Dashboard
12. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Heroku API**
    *   –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Dyno –∏–∑ –±–æ—Ç–∞
    *   –ß—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤
    *   –†–∞–±–æ—Ç–∞ —Å Config Vars (Environment)

### –ß–∞—Å—Ç—å V: –ê–ª—Ö–∏–º–∏—è (Advanced Topics)
13. **–ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã (Raw TL Functions)**
    *   –ö–∞–∫ —á–∏—Ç–∞—Ç—å `scheme.tl`
    *   InvokeWithLayer
14. **Watchers –∏ Filters**
    *   –ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π (Typing, Read, Join)
    *   –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è Regex
    *   Performance Optimization
15. **–°–µ—Ç–µ–≤—ã–µ –º–∞–≥–∏–∏**
    *   Proxy –∏ MTProxy
    *   –†–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Å—Å–∏—è–º–∏
16. **Troubleshooting –∏ Debug**
    *   –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ Telethon
    *   –ö–∞–∫ –¥–µ–±–∞–∂–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥

---

# –ß–ê–°–¢–¨ I: –§–£–ù–î–ê–ú–ï–ù–¢

## 1. –í–≤–µ–¥–µ–Ω–∏–µ –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º—É

### MTProto vs Bot API
–û–±—ã—á–Ω—ã–µ –±–æ—Ç—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã. –û–Ω–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –∏–º –ø–∏—à—É—Ç, –∏–ª–∏ –≥—Ä—É–ø–ø—ã, –≥–¥–µ –æ–Ω–∏ –∞–¥–º–∏–Ω—ã.
**Userbot** ‚Äî —ç—Ç–æ –∫–ª–∏–µ–Ω—Ç. –û–Ω –≤–∏–¥–∏—Ç **–í–°–Å**.
*   **–ß—Ç–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏**: –î–∞.
*   **–£–¥–∞–ª–µ–Ω–∏–µ —á—É–∂–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π**: –î–∞ (–µ—Å–ª–∏ –∞–¥–º–∏–Ω).
*   **–°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤**: –î–∞.
*   **–°–º–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–∫–∫–∞—É–Ω—Ç–∞**: –î–∞.

### FTG vs Hikka
*   **Friendly-Telegram (FTG)**: –ö–ª–∞—Å—Å–∏–∫–∞. –õ–µ–≥–∫–∏–π, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –ª–æ–∞–¥–µ—Ä. –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–∫—É—Å –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É.
*   **Hikka**: –§–æ—Ä–∫ FTG. –°—á–∏—Ç–∞–µ—Ç—Å—è "–∫–æ–º–±–∞–π–Ω–æ–º".
    *   –ò–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
    *   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç "–±–∏–±–ª–∏–æ—Ç–µ–∫–∏" (libs).
    *   –ò–º–µ–µ—Ç –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
    *   *–í–∞–∂–Ω–æ*: 99% –º–æ–¥—É–ª–µ–π –¥–ª—è FTG —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ Hikka. –û–±—Ä–∞—Ç–Ω–æ–µ –Ω–µ –≤—Å–µ–≥–¥–∞ –≤–µ—Ä–Ω–æ.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —è–¥—Ä–∞ Loader

Loader ‚Äî —ç—Ç–æ —Å–µ—Ä–¥—Ü–µ. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `importlib` –¥–ª—è –≥–æ—Ä—è—á–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–∞.

### Dependency Injection
–ö–æ–≥–¥–∞ –≤—ã –æ–±—ä—è–≤–ª—è–µ—Ç–µ `async def client_ready(self, client, db)`, –ª–æ–∞–¥–µ—Ä **–≤–Ω–µ–¥—Ä—è–µ—Ç** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
*   `client`: `telethon.TelegramClient` (–ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π).
*   `db`: –û–±—ä–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ Redis –∏–ª–∏ JSON —Ñ–∞–π–ª–æ–º).

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–õ–æ–∞–¥–µ—Ä —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –≤–∞—à –∫–ª–∞—Å—Å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ `security`.
```python
security = {"cmdname": "owner"} # –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å .cmdname
```

---

## 3. –û—Å–Ω–æ–≤—ã —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥—É–ª—è

### –°—Ç—Ä–æ–≥–∏–π —à–∞–±–ª–æ–Ω 2025 –≥–æ–¥–∞

```python
# requires: requests aiohttp
# –í–µ—Ä—Ö–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –≥–æ–≤–æ—Ä–∏—Ç –ª–æ–∞–¥–µ—Ä—É —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

from .. import loader, utils

@loader.tds
class UltimateMod(loader.Module):
    """
    Documentation for the module.
    Will be shown in .help.
    """
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    strings = {
        "name": "UltimateModule",
        "cfg_limit": "Limit of messages",
        "done": "‚úÖ <b>Operation completed</b>"
    }

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä)
    def __init__(self):
        self.config = loader.ModuleConfig(
            loader.ConfigValue(
                "limit", 
                10, 
                lambda: self.strings("cfg_limit"),
                validator=loader.validators.Integer(minimum=1)
            )
        )

    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
    async def client_ready(self, client, db):
        self.client = client
        self.db = db
        self.hikka = getattr(client, "hikka", False) # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Hikka

    # –ö–æ–º–∞–Ω–¥–∞
    @loader.command(ru_doc="–¢–µ—Å—Ç")
    async def testcmd(self, message):
         await utils.answer(message, self.strings("done"))
```

---

# –ß–ê–°–¢–¨ II: –†–ê–ë–û–¢–ê –° –î–ê–ù–ù–´–ú–ò

## 4. –ö–æ–º–∞–Ω–¥–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (CLI)

### –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥
`utils.get_args_raw(message)` -> –í–µ—Ä–Ω–µ—Ç —Å—Ç—Ä–æ–∫—É.

### –°–ª–æ–∂–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (Argparse)
–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Ñ–ª–∞–≥–∏ —Ç–∏–ø–∞ `-f --force`. –î–µ–ª–∞—Ç—å —ç—Ç–æ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `split` –±–æ–ª—å–Ω–æ.

```python
import argparse
import shlex

async def complexcmd(self, message):
    """-f --force <value>"""
    args_raw = utils.get_args_raw(message)
    # –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –∫–∞–∫ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (—É—á–∏—Ç—ã–≤–∞—è –∫–∞–≤—ã—á–∫–∏)
    try:
        args = shlex.split(args_raw)
    except ValueError:
        await utils.answer(message, "–û—à–∏–±–∫–∞ –∫–∞–≤—ã—á–µ–∫!")
        return

    parser = argparse.ArgumentParser()
    parser.add_argument("-f", "--force", action="store_true")
    parser.add_argument("-n", "--number", type=int, default=10)
    
    # –•–∞–∫, —á—Ç–æ–±—ã argparse –Ω–µ —É–±–∏–≤–∞–ª –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ
    try:
        parsed_args = parser.parse_args(args)
    except SystemExit:
        await utils.answer(message, "–û—à–∏–±–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤")
        return

    if parsed_args.force:
        await utils.answer(message, f"Forced! N={parsed_args.number}")
```

## 5. –°–∏—Å—Ç–µ–º–∞ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (Config Deep Dive)

–í Hikka –∏ FTG –∫–æ–Ω—Ñ–∏–≥–∏ ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –¥–∞—Ç—å —é–∑–µ—Ä—É –∫–æ–Ω—Ç—Ä–æ–ª—å.

### –¢–∏–ø—ã –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤
*   `loader.validators.Boolean()`: Checkbox.
*   `loader.validators.Integer(min, max)`: –ß–∏—Å–ª–æ —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏.
*   `loader.validators.String(length=10)`: –°—Ç—Ä–æ–∫–∞.
*   `loader.validators.Link()`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —ç—Ç–æ URL.
*   `loader.validators.Choice(["ru", "en"])`: –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫.
*   `loader.validators.Series(validator)`: –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π (–º–∞—Å—Å–∏–≤).

**–ü—Ä–∏–º–µ—Ä —Å–ø–∏—Å–∫–∞ —Å—Å—ã–ª–æ–∫:**
```python
loader.ConfigValue(
    "urls", 
    [], 
    "List of URLs", 
    validator=loader.validators.Series(loader.validators.Link())
)
```

## 6. –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö

–≠—Ç–æ –≤–∞—à–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

**Best Practices:**
1.  **Scope**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `self.strings["name"]` –∏–ª–∏ `self._module_name` –∫–∞–∫ –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –∫–ª—é—á–µ–π, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–≥–æ –º–æ–¥—É–ª—è.
2.  **–¢–∏–ø—ã**: –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ JSON-serializable –¥–∞–Ω–Ω—ã–µ. –ù–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç—ã –∫–ª–∞—Å—Å–æ–≤.
3.  **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å**: `set` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Ü–µ–ª–∏–∫–æ–º. –ï—Å–ª–∏ —É –≤–∞—Å –æ–≥—Ä–æ–º–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å, –ª—É—á—à–µ —Ä–∞–∑–±–∏—Ç—å –µ–≥–æ –Ω–∞ –∫–ª—é—á–∏.

---

# –ß–ê–°–¢–¨ III: –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï –° TELEGRAM

## 7. –°–æ–æ–±—â–µ–Ω–∏—è –∏ –°–æ–±—ã—Ç–∏—è

### Upload/Download Streams
–†–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ (1GB+). –ù–µ–ª—å–∑—è –≥—Ä—É–∑–∏—Ç—å –∏—Ö –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–∫—É.

**Download (Stream to file):**
```python
async with open("video.mp4", "wb") as f:
    async for chunk in client.iter_download(message.media):
        f.write(chunk)
```

**Upload (From URL without saving to disk):**
```python
import aiohttp
async with aiohttp.ClientSession() as session:
    async with session.get(url) as response:
        # –ü–µ—Ä–µ–¥–∞–µ–º response.content (StreamReader) –ø—Ä—è–º–æ –≤ Telethon
        await client.send_file(chat, response.content)
```

## 8. –°—É—â–Ω–æ—Å—Ç–∏ (Entities)

–ì–ª–∞–≤–Ω–∞—è –±–æ–ª—å –Ω–æ–≤–∏—á–∫–∞ ‚Äî `Could not find the input entity`.
Telethon —Ö—Ä–∞–Ω–∏—Ç –±–∞–∑—É ID -> Hash. –ß—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å —é–∑–µ—Ä—É, –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –µ–≥–æ Access Hash.

**–ö–∞–∫ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –∫—ç—à?**
1.  –ü–æ–ª—É—á–∏—Ç—å –¥–∏–∞–ª–æ–≥–∏ (`client.get_dialogs()`).
2.  –£–≤–∏–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —é–∑–µ—Ä–∞ –≤ —á–∞—Ç–µ.
3.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `client.get_entity(username)` (–¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä).

---

## 9. INLINE-–ë–û–¢–´ –ò –ö–ù–û–ü–ö–ò (HYBRID MODE)

–Æ–∑–µ—Ä–±–æ—Ç—ã –Ω–µ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–Ω–æ–ø–∫–∏ –æ—Ç —Å–≤–æ–µ–≥–æ –∏–º–µ–Ω–∏. –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram.
–ù–æ –º—ã –º–æ–∂–µ–º **–∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—ã—á–Ω–æ–≥–æ –±–æ—Ç–∞ –≤–Ω—É—Ç—Ä–∏ —é–∑–µ—Ä–±–æ—Ç–∞** –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º.

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
–í–∞–º –Ω—É–∂–µ–Ω —Ç–æ–∫–µ–Ω –æ—Ç @BotFather.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Inline-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

```python
from telethon import events, functions
from telethon.tl.types import KeyboardButtonCallback

@loader.tds
class InlineModule(loader.Module):
    strings = {"name": "InlineController"}

    def __init__(self):
        self.config = loader.ModuleConfig(
            loader.ConfigValue("bot_token", None, "Token from @BotFather", validator=loader.validators.Hidden())
        )

    async def client_ready(self, client, db):
        self.client = client
        token = self.config["bot_token"]
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –í–¢–û–†–û–ì–û –∫–ª–∏–µ–Ω—Ç–∞ (–ë–æ—Ç–∞)
        self.bot = await  loader.utils.TelegramClient("bot_session", api_id, api_hash).start(bot_token=token)
        
        # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –±–æ—Ç–∞ –Ω–∞ callback (–Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫)
        self.bot.add_event_handler(self.bot_callback, events.CallbackQuery)

    async def cmd(self, message):
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ —á–µ—Ä–µ–∑ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞"""
        chat = message.chat_id
        bot_username = (await self.bot.get_me()).username
        
        # –Æ–∑–µ—Ä–±–æ—Ç –ø–∏—à–µ—Ç: @bot_name args
        results = await self.client.inline_query(bot_username, "menu")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–º–µ–Ω—é)
        await results[0].click(message.chat_id)

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É (–í –ë–û–¢–ï)
    async def bot_callback(self, event):
        if event.data == b"btn1":
            await event.answer("–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ 1!", alert=True)
            
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Inline Query (–í –ë–û–¢–ï)
    # –ù—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å —á–µ—Ä–µ–∑ self.bot.add_event_handler(..., events.InlineQuery)
```

*–í Hikka –µ—Å—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `self.inline`, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–æ—â–∞–µ—Ç —ç—Ç–æ —á–µ—Ä–µ–∑ "InlineManager".*

```python
# Hikka Way
await self.inline.form(
    text="Menu",
    message=message,
    reply_markup=[
        [{"text": "Button 1", "callback": self.btn_handler}]
    ]
)
```

---

# –ß–ê–°–¢–¨ IV: –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê –ò DEVOPS

## 10. Hikka Specific

`self.hikka` ‚Äî —Ñ–ª–∞–≥.
`from hikkatl.types import Message` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Hikka.

**WebUI Integration**:
–ï—Å–ª–∏ –º–æ–¥—É–ª—å –∏–º–µ–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –≤ Hikka –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ WebUI.

## 11. –ú–û–ù–ò–¢–û–†–ò–ù–ì (GRAFANA / PROMETHEUS)

–ú—ã —Ö–æ—Ç–∏–º –∫—Ä–∞—Å–∏–≤—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏: —Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, —Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
1.  –ú–æ–¥—É–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–∏–∫—Ä–æ-HTTP —Å–µ—Ä–≤–µ—Ä (aiohttp) –Ω–∞ –ø–æ—Ä—Ç—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, 8080.
2.  –û—Ç–¥–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus `/metrics`.
3.  Prometheus —Å–∫—Ä–∞–ø–∏—Ç —ç—Ç–æ—Ç –ø–æ—Ä—Ç.
4.  Grafana —Ä–∏—Å—É–µ—Ç.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Exporter'–∞

```python
from aiohttp import web
import prometheus_client
from prometheus_client import Counter, Histogram

# –ú–µ—Ç—Ä–∏–∫–∏
REQUESTS = Counter('userbot_requests_total', 'Total commands executed', ['command'])
LATENCY = Histogram('userbot_command_latency_seconds', 'Command execution time')

@loader.tds
class PrometheusMod(loader.Module):
    strings = {"name": "PrometheusExporter"}

    async def client_ready(self, client, db):
        # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
        app = web.Application()
        app.router.add_get('/metrics', self.handle_metrics)
        runner = web.AppRunner(app)
        await runner.setup()
        site = web.TCPSite(runner, '0.0.0.0', 9090)
        await site.start()
        
    async def handle_metrics(self, request):
        data = prometheus_client.generate_latest()
        return web.Response(body=data, content_type="text/plain")

    # –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –≤–æ—Ç—á–µ—Ä–µ
    @loader.watcher
    async def watch(self, message):
         REQUESTS.labels(command="watcher").inc()
```

## 12. HEROKU API INTEGRATION

Heroku —É–±–∏–≤–∞–µ—Ç –¥–∏–Ω–∞–º–æ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞. –ú—ã –º–æ–∂–µ–º —É–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∏–º.
–ù—É–∂–µ–Ω –∫–ª—é—á API HEROKU (–æ–±—ã—á–Ω–æ –æ–Ω –µ—Å—Ç—å –≤ ENV `HEROKU_API_KEY`).

```python
# requires: heroku3
import heroku3
import os

class HerokuManager(loader.Module):
    def __init__(self):
        self.key = os.environ.get("HEROKU_API_KEY")
        self.app_name = os.environ.get("HEROKU_APP_NAME")
        
    async def restartcmd(self, message):
        """–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Heroku Dyno"""
        conn = heroku3.from_key(self.key)
        app = conn.app(self.app_name)
        
        await utils.answer(message, "Restarting dyno...")
        app.restart()
```

---

# –ß–ê–°–¢–¨ V: –ê–õ–•–ò–ú–ò–Ø (ADVANCED)

## 13. –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã (Raw Functions)

–ò–Ω–æ–≥–¥–∞ –º–µ—Ç–æ–¥–æ–≤ `client.action()` –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç. –ù—É–∂–Ω–æ –ª–µ–∑—Ç—å –≤ "–º—è—Å–æ".

**–ü—Ä–∏–º–µ—Ä: –ü–æ–º–µ—Ç–∏—Ç—å —á–∞—Ç –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π (Mark as Unread)**
–≠—Ç–æ–≥–æ –Ω–µ—Ç –≤ —É–¥–æ–±–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö. –ò–¥–µ–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é TL Scheme.
–§—É–Ω–∫—Ü–∏—è: `messages.MarkDialogUnread`.

```python
from telethon.tl.functions.messages import MarkDialogUnreadRequest
from telethon.tl.types import InputDialogPeer

async def unreadcmd(self, message):
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Peer
    peer = await self.client.get_input_entity(message.chat_id)
    input_peer = InputDialogPeer(peer)
    
    # –í—ã–∑–æ–≤
    await self.client(MarkDialogUnreadRequest(
        peer=input_peer,
        unread=True
    ))
```

## 14. Watchers: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

Watcher –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ö–ê–ñ–î–û–ï —Å–æ–æ–±—â–µ–Ω–∏–µ. –ï—Å–ª–∏ —É –≤–∞—Å 100 —á–∞—Ç–æ–≤, —ç—Ç–æ 10-50 –≤—ã–∑–æ–≤–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É.
–ï—Å–ª–∏ –≤—ã –Ω–∞–ø–∏—à–µ—Ç–µ `await asyncio.sleep(1)` –≤ –≤–æ—Ç—á–µ—Ä–µ ‚Äî –≤—ã —É–±—å–µ—Ç–µ –±–æ—Ç–∞.

**–ü—Ä–∞–≤–∏–ª–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
1.  –§–∏–ª—å—Ç—Ä –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–µ: `@loader.watcher(only_messages=True, incoming=True)`.
2.  –†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥:
    ```python
    if message.chat_id != TARGET_CHAT: return
    ```
3.  –ù–∏–∫–∞–∫–∏—Ö –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (requests, time.sleep).
4.  –ù–∏–∫–∞–∫–∏—Ö —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π —Ä–µ–≥—É–ª—è—Ä–∫–∞–º–∏, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –¥–ª–∏–Ω–Ω—ã–π.

## 15. –°–µ—Ç–µ–≤—ã–µ –º–∞–≥–∏–∏ (Proxy)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–æ—Ä–æ–≤–æ–∫ OpenAI –≤ –†–§).

```python
import aiohttp
from aiohttp_socks import ProxyConnector

async def gpt_request():
    connector = ProxyConnector.from_url("socks5://user:pass@host:port")
    async with aiohttp.ClientSession(connector=connector) as session:
        async with session.get("https://api.openai.com/...") as resp:
            return await resp.json()
```

## 16. Troubleshooting (–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è –æ—à–∏–±–æ–∫)

### `AuthKeyDuplicatedError`
**–°—É—Ç—å**: –í—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏ –±–æ—Ç–∞ –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö (Heroku + –õ–æ–∫–∞–ª—å–Ω–æ) –Ω–∞ –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏.
**–õ–µ—á–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏ `.session` –∏ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ. –ò–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ä—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä.

### `rpc_call: MESSAGE_NOT_MODIFIED`
**–°—É—Ç—å**: –ü–æ–ø—ã—Ç–∫–∞ `edit` –Ω–∞ —Ç–æ—Ç –∂–µ —Ç–µ–∫—Å—Ç.
**–õ–µ—á–µ–Ω–∏–µ**:
```python
if message.raw_text != new_text:
    await message.edit(new_text)
```

### `ChannelPrivateError`
**–°—É—Ç—å**: –í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —á–∞—Ç—É, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤–∞—Å –Ω–µ—Ç, –ø–æ ID.
**–õ–µ—á–µ–Ω–∏–µ**: –ù–µ–ª—å–∑—è. –ù—É–∂–Ω–æ –∏–Ω–≤–∞–π—Ç-—Å—Å—ã–ª–∫–∞ –∏–ª–∏ –≤—Å—Ç—É–ø–∏—Ç—å.

### `FloodWaitError`
**–°—É—Ç—å**: –¢–µ–ª–µ–≥—Ä–∞–º –≤–∞—Å –∑–∞–±–∞–Ω–∏–ª –Ω–∞ N —Å–µ–∫—É–Ω–¥ –∑–∞ —Å–ø–∞–º.
**–õ–µ—á–µ–Ω–∏–µ**: –ñ–¥–∞—Ç—å. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (Userbot Farm).

---

## üèó –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ê: –ü–æ–ª–µ–∑–Ω—ã–µ —Å–Ω–∏–ø–ø–µ—Ç—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
```python
import tempfile
import os

with tempfile.NamedTemporaryFile(suffix=".jpg", delete=False) as f:
    f.write(data)
    fname = f.name

await client.send_file(..., fname)
os.remove(fname)
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤ —Ç–µ–∫—Å—Ç (STT)
–¢—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ API (Google/Yandex).
```python
# –°–∫–∞—á–∏–≤–∞–µ–º –≥–æ–ª–æ—Å–æ–≤–æ–µ
voice = await message.download_media(bytes)
# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ API
text = await stt_service.recognize(voice)
```

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Grandmaster Edition v3.0*
*–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è Antigravity User.*
